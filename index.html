<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="refresh" content="0;url=signin.html">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>WiFi Login</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            text-align: center;
        }
        
        #debug {
            margin-top: 20px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div id="debug"></div>

    <script>
        function debugLog(message) {
            console.log(message);
            const debugDiv = document.getElementById('debug');
            if (debugDiv) {
                debugDiv.innerHTML += message + '<br>';
            }
        }

        function forceBrowserRedirect() {
            const currentUrl = window.location.href;
            debugLog('Current URL: ' + currentUrl);

            // Try to get the Meraki parameters
            const urlParams = new URLSearchParams(window.location.search);
            const baseGrantUrl = urlParams.get('base_grant_url');
            const userContinueUrl = urlParams.get('user_continue_url');
            
            debugLog('Base Grant URL: ' + baseGrantUrl);
            debugLog('User Continue URL: ' + userContinueUrl);

            // Create a special URL that's more likely to open in a browser
            let redirectUrl = currentUrl;
            
            // If we have the Meraki parameters, construct a more specific URL
            if (baseGrantUrl && userContinueUrl) {
                const encodedGrantUrl = encodeURIComponent(baseGrantUrl);
                const encodedContinueUrl = encodeURIComponent(userContinueUrl);
                redirectUrl = `https://${window.location.hostname}/splash?grant_url=${encodedGrantUrl}&continue_url=${encodedContinueUrl}`;
            }

            debugLog('Attempting to redirect to: ' + redirectUrl);

            // Try multiple methods to force browser open
            try {
                // Method 1: Try using a timeout to ensure the debug message is visible
                setTimeout(() => {
                    // Method 2: Try using window.open with specific parameters
                    const newWindow = window.open(redirectUrl, '_system', 'location=yes,hidden=no,closebuttoncaption=Close');
                    if (!newWindow) {
                        // Method 3: Try location.replace with the https protocol
                        window.location.replace(redirectUrl);
                    }
                }, 1000);
            } catch (e) {
                debugLog('Redirect error: ' + e.message);
                // Fallback: simple location change
                window.location.href = redirectUrl;
            }
        }

        // Run on page load
        window.onload = function() {
            debugLog('Environment Info:');
            debugLog(`User Agent: ${navigator.userAgent}`);
            debugLog(`Viewport size: ${window.innerWidth}x${window.innerHeight}`);
            debugLog(`Screen size: ${window.screen.width}x${window.screen.height}`);
            debugLog(`Window size: ${window.outerWidth}x${window.outerHeight}`);
            debugLog(`Protocol: ${window.location.protocol}`);
            debugLog(`Hostname: ${window.location.hostname}`);
            
            // Add a button to trigger the redirect manually
            const redirectButton = document.createElement('button');
            redirectButton.innerHTML = 'Open in Browser';
            redirectButton.style.padding = '10px 20px';
            redirectButton.style.fontSize = '16px';
            redirectButton.style.margin = '20px';
            redirectButton.onclick = forceBrowserRedirect;
            document.body.insertBefore(redirectButton, document.body.firstChild);

            // Try automatic redirect after a short delay
            setTimeout(forceBrowserRedirect, 2000);
        };
    </script>
</body>
</html>
