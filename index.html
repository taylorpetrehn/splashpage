<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="refresh" content="0;url=signin.html">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>WiFi Login</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            text-align: center;
        }
        
        #debug {
            margin-top: 20px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div id="debug"></div>

    <script>
        // Debug function
        function debugLog(message) {
            console.log(message);
            const debugDiv = document.getElementById('debug');
            debugDiv.innerHTML += `<div>${message}</div>`;
        }

        // Get URL parameters
        function getUrlParams() {
            const searchParams = new URLSearchParams(window.location.search);
            const params = {
                base_grant_url: searchParams.get('base_grant_url'),
                user_continue_url: searchParams.get('user_continue_url'),
                node_mac: searchParams.get('node_mac'),
                client_mac: searchParams.get('client_mac'),
                client_ip: searchParams.get('client_ip')
            };
            
            debugLog('URL Parameters:');
            Object.entries(params).forEach(([key, value]) => {
                debugLog(`${key}: ${value || 'NOT PROVIDED'}`);
            });
            
            return params;
        }

        // Store parameters and redirect
        function init() {
            debugLog('Page loaded');
            
            // Store parameters
            const params = getUrlParams();
            localStorage.setItem('merakiParams', JSON.stringify(params));
            
            // Check environment
            if (window.navigator.standalone !== undefined) {
                debugLog('Running in WebKit WebView');
            } else {
                debugLog('Running in regular browser');
            }
            
            // Construct signin URL with parameters
            const currentUrl = window.location.href;
            const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/') + 1);
            const signinUrl = baseUrl + 'signin.html?' + new URLSearchParams(params).toString();
            
            debugLog('Attempting to redirect to: ' + signinUrl);
            
            // Try multiple methods to open in full browser
            try {
                // Method 1: Try window.open
                const newWindow = window.open(signinUrl, '_blank');
                if (newWindow) {
                    debugLog('Window.open succeeded');
                    return;
                }
                
                // Method 2: Try location.replace
                debugLog('Window.open failed, trying location.replace');
                window.location.replace(signinUrl);
            } catch (error) {
                debugLog('Error during redirect: ' + error);
                
                // Method 3: Fallback to basic redirect
                window.location.href = signinUrl;
            }
        }

        // Run initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
