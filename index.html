<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi Login</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        .container {
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .logo {
            max-width: 200px;
            height: auto;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://images.squarespace-cdn.com/content/v1/52e833f5e4b0dacf750e66a1/1713980671673-40FA15S8B2LS62Q4QYC9/logotype-wh.png?format=2500w" alt="Logo" class="logo">
        <div id="debug"></div>
        <button onclick="handleConnect()">Connect to WiFi</button>
    </div>

    <script>
        // Debug function to display information
        function debugLog(message) {
            console.log(message);
            const debugDiv = document.getElementById('debug');
            debugDiv.innerHTML += `<div>${message}</div>`;
        }

        // Get URL parameters
        function getUrlParams() {
            const searchParams = new URLSearchParams(window.location.search);
            const params = {
                base_grant_url: searchParams.get('base_grant_url'),
                user_continue_url: searchParams.get('user_continue_url'),
                node_mac: searchParams.get('node_mac'),
                client_mac: searchParams.get('client_mac'),
                client_ip: searchParams.get('client_ip')
            };
            
            debugLog('URL Parameters:');
            Object.entries(params).forEach(([key, value]) => {
                debugLog(`${key}: ${value || 'NOT PROVIDED'}`);
            });
            
            return params;
        }

        // Store parameters in localStorage
        function storeParams() {
            const params = getUrlParams();
            localStorage.setItem('merakiParams', JSON.stringify(params));
        }

        // Handle connect button click
        function handleConnect() {
            debugLog('Connect button clicked');
            
            const params = getUrlParams();
            if (!params.base_grant_url || !params.user_continue_url) {
                debugLog('Error: Missing required Meraki parameters');
                return;
            }

            // Try different methods to open in full browser
            const currentUrl = window.location.href;
            const signinUrl = currentUrl.replace('index.html', 'signin.html');
            
            debugLog('Attempting to open signin page...');

            // Method 1: Try window.open
            const newWindow = window.open(signinUrl, '_blank');
            if (newWindow) {
                debugLog('Window.open succeeded');
                return;
            }

            // Method 2: Try location.href with a timeout
            debugLog('Window.open failed, trying location.href');
            setTimeout(() => {
                window.location.href = signinUrl;
            }, 100);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('Page loaded');
            storeParams();
            
            // Check if we're in a captive portal context
            if (window.navigator.standalone !== undefined) {
                debugLog('Running in WebKit WebView');
            } else {
                debugLog('Running in regular browser');
            }
        });
    </script>
</body>
</html>
